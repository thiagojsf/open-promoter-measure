<!doctype html>
<html ng-app="linxAuto">
  <head>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>
	<script type="text/javascript">

		var print = function(codigo) {
			console.log("teste ", codigo);
		}
		
		var caminho = "http://service-hom.linxauto.com.br/LinxDmsOperacionalAvaliacao/GetDmsAvaliacaoByEntitySearchNoAssociations?$orderby=IdAvaliacao&$top=100&$inlinecount=allpages&jEntitySearch=DmsAvaliacao%7B%7DGrupoAvaliacao%7B%7D";
		var caminho2 = "http://service-hom.linxauto.com.br/DMSFichaMobile/CarregarOpcionais?IdTipoVeiculo=1";
		var urlTitulos = "http://qua.ux.linx.com.br/Service/5.X/LinxAdmFinConsultaConsultaAnaliticaContaReceber/GetFinReceberAnaliticoByEntitySearchNoAssociations?$orderby=Adquirente&jEntitySearch=FinReceberAnalitico%7BEmissaoDe%23%3E%3D%23T2018-03-01%252000%253A00%253A00.000%3BEmissaoDe%23%3C%3D%23T2018-03-01%252023%253A59%253A59.999%3BLxTipo%23%3D%3D%23I1%7D"

		var request = function(url, $http, emCasoDeSucesso){
		
			var $headers = {
					Application: "6d26d800-bbf8-4843-bca9-51dbfa200bc2",
					AuthorizationToken: "b855857d-4a05-4cdf-aefb-50e861e0914a",
					Branch: -1,
					CurrentCompany: "74351065-0a60-48b7-9774-ba97d99f1c9f",
					CurrentUser: "77d21861-51fa-4af1-8063-3392c65936ac",
					EconomicGroup: "74351065-0a60-48b7-9774-ba97d99f1c9f",
					Environment: 1062
			};
		
			var parametrosRequisicao = {
				headers : $headers,
				url : url,
				method : 'GET',
				crossDomain: true,
			};
			
			$http(parametrosRequisicao).then(function(res){
				emCasoDeSucesso(res);
			}, function(err){
				console.log(err);
			});
		};

		var funcaoController = function($scope, $http, svcAvaliacao) {
			$scope.yourName = "Guilherme";
			print(2);
			request(caminho, $http, function(response){
				console.log("LInha 43");
				console.log(response.data);
			});
		};
		
		var dependencias = [];
	
		var modulo = angular.module('linxAuto', dependencias);
		modulo.controller("meuController", funcaoController);
		modulo.controller("meuController2", function($scope, svcAvaliacao){
			$scope.yourName = "Paulo";
			print(1);
			svcAvaliacao.carregarOpcionais(function(response){
				$scope.Opcionais = response.data;
			});
		})
		modulo.controller("meuController3", function($scope, svcTitulos) {
			$scope.ontem = new Date(2018, 3, 20);
			$scope.hoje = new Date();
			$scope.dataEmissao = new Date(2018, 3, 20);
			$scope.dataVencimento = new Date(2018, 6, 20);
			$scope.valorTotal = 5000;
			$scope.valorEmAberto = 0;
			$scope.numeroTitulo = 5321;
			$scope.numeroNota = 32531;
			$scope.serieNota = 1;
			$scope.parcela = 3;
			$scope.fornecedor = "SAMSUNG";
			$scope.filial = "Linx SP";

			svcTitulos.carregaTitulosAPagar(function(res){
				$scope.Titulos = res.data;
				for (var i = 0; i < $scope.Titulos.length; i++) {

					$scope.Titulos[i].Emissao = new Date($scope.Titulos[i].Emissao);
					$scope.Titulos[i].Vencimento = new Date($scope.Titulos[i].Vencimento);

					if ($scope.Titulos[i].Vencimento <= new Date())
					{
						$scope.Titulos[i].TextoVencimento = "Venceu";
						$scope.Titulos[i].EstaVencido = true;
						
					}
					else
					{
						$scope.Titulos[i].TextoVencimento = "Vence";
						$scope.Titulos[i].EstaVencido = false;
					}

					if ($scope.Titulos[i].LxStatusDocName != undefined && $scope.Titulos[i].LxStatusDocName.length > 0)
					{
						$scope.Titulos[i].AbreviacaoTitulo = $scope.Titulos[i].LxStatusDocName.substring(0,1);
					}
					else
					{

					}
					
				}
			});

			
			
			
		})
		.factory("svcAvaliacao", function($http){
			var obj = {
				carregarOpcionais : function(emCasoDeSucesso){
					request(caminho2, $http, function(response){
						emCasoDeSucesso(response);
					});
				}
			}
			return obj;
		})
		.factory("svcTitulos", function($http){
			return {
				carregaTitulosAPagar : function(emCasoDeSucesso){
					request(urlTitulos, $http, function(res){
						emCasoDeSucesso(res);
					})
				}
			}
		})
	</script>
  
	<link rel="stylesheet" type="text/css" href="http://app-hom.linxauto.com.br/app/resources/weblayout/linx-bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="http://app-hom.linxauto.com.br/app/resources/weblayout/ui-bootstrap-custom-2.5.0-csp.css" />
	<script type="text/javascript" src="http://app-hom.linxauto.com.br/app/resources/weblayout/linx-bootstrap.js"></script>
	<style type="text/css">
		.titulo {
			font-size: 20px;
		}
		.texto-vermelho {
			color: red;
		}
		.card {
			border-radius: 0.5em;
			text-align: center;
			background-color: transparent;
			border: 1px solid #5b2e90;
			border-radius: 0.5em;
			margin-left: 0px;
    		margin-right: 0px;
			margin-bottom: 5px;
		}
	</style>
	<script type="text/javascript" src="http://code.angularjs.org/1.6.9/i18n/angular-locale_pt-br.js"></script>
  </head>
  <body>
  <!--
    <div ng-controller="meuController">
      <label>Name:</label>
      <input type="text" ng-model="yourName" placeholder="Enter a name here">
      <hr>
      <h1 ng-show="yourName == 'Thiago'">Hello {{yourName}}!</h1>
	  <h1 ng-show="yourName != 'Thiago'">Bye {{yourName}}!</h1>
    </div>
	<div ng-controller="meuController2">
      <label>Name:</label>
      <input type="text" ng-model="yourName" placeholder="Enter a name here">
      <hr>
		<div ng-repeat="Opcional in Opcionais">
			<input type="text" ng-model="Opcional.DescOpcional" />
		</div>
    </div>
	-->
	<div class="container" ng-controller="meuController3">
		<input type="search" ng-model="textoPesquisa" />
		<div class="row">
			<div class="card row col-md-6" ng-repeat="Titulo in Titulos | filter:textoPesquisa">
				<div class="info-financeiras col-xs-10">
					<div class="titulo text-center"><strong>{{ Titulo.NomeCliente }}</strong></div>
					<div class="numero-titulo text-center">Nº {{Titulo.NrDocumento}} (NF {{numeroNota}}/{{serieNota}}) {{Titulo.Parcela}}ª Parcela</div>
					<div class="descr-titulo text-center">Emitido em {{Titulo.Emissao | date:"dd/MM/yyyy"}} / <span ng-class=" { 'texto-vermelho' : Titulo.EstaVencido } ">{{ Titulo.TextoVencimento }} em {{ Titulo.Vencimento | date:"dd/MM/yyyy" }}</span></div>
					<div class="valores text-center">{{ Titulo.ValorOriginal | currency }} <span ng-if="Titulo.ValorEmAberto > 0">(em aberto {{ Titulo.ValorEmAberto | currency }})</span></div>
					<div class="info-adicionais text-center">{{Titulo.NomeFilial}}</div>
				</div>
				<div class="icones col-xs-2">
					<div class="tipo" title="{{Titulo.LxStatusDocName}}">{{ Titulo.AbreviacaoTitulo }}</div>
					<div class="status">A</div>
				</div>
			</div>
		</div>
	</div>
  </body>
</html>